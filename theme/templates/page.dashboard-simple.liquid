{% layout 'theme' %}

<style>
  .dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  .dashboard-header {
    margin-bottom: 2rem;
  }
  
  .dashboard-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: #1F2937;
    margin-bottom: 0.5rem;
  }
  
  .dashboard-header p {
    color: #6B7280;
  }
</style>

<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>{{ 'priceelephant.dashboard.title' | t }}</h1>
    <p>{{ 'priceelephant.homepage.hero.welcome_back' | t: name: customer.first_name }}</p>
  </div>
  
  <!-- Competitor Manager Component -->
  <div id="competitor-manager-app"></div>
  
  <!-- Other Dashboard Sections -->
  {% section 'priceelephant-dashboard' %}
</div>

<!-- Load Competitor Manager -->
{{ 'competitor-manager.js' | asset_url | script_tag }}

<script>
  // Pass Shopify translations to JavaScript
  window.PRICEELEPHANT_TRANSLATIONS = {
    competitor_manager: {
      title: {{ 'priceelephant.dashboard.competitor_manager.title' | t | json }},
      add_button: {{ 'priceelephant.dashboard.competitor_manager.add_button' | t | json }},
      limit_info: {{ 'priceelephant.dashboard.competitor_manager.limit_info' | t | json }},
      upgrade_link: {{ 'priceelephant.dashboard.competitor_manager.upgrade_link' | t | json }},
      empty_state: {{ 'priceelephant.dashboard.competitor_manager.empty_state' | t | json }},
      modal: {
        title: {{ 'priceelephant.dashboard.competitor_manager.modal.title' | t | json }},
        description: {{ 'priceelephant.dashboard.competitor_manager.modal.description' | t | json }},
        url_label: {{ 'priceelephant.dashboard.competitor_manager.modal.url_label' | t | json }},
        url_placeholder: {{ 'priceelephant.dashboard.competitor_manager.modal.url_placeholder' | t | json }},
        url_hint: {{ 'priceelephant.dashboard.competitor_manager.modal.url_hint' | t | json }},
        cancel: {{ 'priceelephant.dashboard.competitor_manager.modal.cancel' | t | json }},
        submit: {{ 'priceelephant.dashboard.competitor_manager.modal.submit' | t | json }},
        loading: {{ 'priceelephant.dashboard.competitor_manager.modal.loading' | t | json }}
      },
      card: {
        in_stock: {{ 'priceelephant.dashboard.competitor_manager.card.in_stock' | t | json }},
        out_stock: {{ 'priceelephant.dashboard.competitor_manager.card.out_stock' | t | json }},
        view_link: {{ 'priceelephant.dashboard.competitor_manager.card.view_link' | t | json }},
        last_check: {{ 'priceelephant.dashboard.competitor_manager.card.last_check' | t | json }},
        refresh: {{ 'priceelephant.dashboard.competitor_manager.card.refresh' | t | json }},
        delete: {{ 'priceelephant.dashboard.competitor_manager.card.delete' | t | json }}
      },
      alerts: {
        limit_reached: {{ 'priceelephant.dashboard.competitor_manager.alerts.limit_reached' | t | json }},
        confirm_delete: {{ 'priceelephant.dashboard.competitor_manager.alerts.confirm_delete' | t | json }},
        delete_failed: {{ 'priceelephant.dashboard.competitor_manager.alerts.delete_failed' | t | json }},
        add_success: {{ 'priceelephant.dashboard.competitor_manager.alerts.add_success' | t | json }},
        add_error: {{ 'priceelephant.dashboard.competitor_manager.alerts.add_error' | t | json }}
      }
    }
  };

  // Initialize Competitor Manager
  document.addEventListener('DOMContentLoaded', function() {
    {% if customer %}
      // Get customer's plan limits (from metafields or API)
      const planLimits = {
        max_competitors: {{ customer.metafield.priceelephant.max_competitors | default: 3 }}
      };
      
      // Initialize with translations
      const manager = new CompetitorManager(
        {{ product.id | default: 'null' }}, 
        planLimits,
        window.PRICEELEPHANT_TRANSLATIONS.competitor_manager
      );
      
      // Render
      document.getElementById('competitor-manager-app').innerHTML = manager.render();
      
      // Load competitors
      manager.loadCompetitors();
    {% else %}
      // Redirect to login if not authenticated
      window.location.href = '/account/login';
    {% endif %}
  });
</script>
