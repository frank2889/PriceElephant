{{ 'priceelephant-dashboard.css' | asset_url | stylesheet_tag }}

{% if customer %}
  <div
    class="pe-dashboard"
    id="priceelephant-dashboard-root"
    data-api-base-url="{{ section.settings.api_base_url | escape }}"
    data-customer-id="{{ customer.id }}"
  >
    <!-- DEBUG PANEL - Theme ID: 155038613720 -->
    <div class="pe-card" style="background: #f0f9ff; border-left: 4px solid #0284c7;">
      <h3 style="margin-top: 0; color: #0284c7;">ðŸ”§ Debug Info (Auto-Deploy Active)</h3>
      <div id="pe-debug-output" style="font-family: monospace; font-size: 12px; line-height: 1.6;">
        <div><strong>Customer ID:</strong> {{ customer.id }}</div>
        <div><strong>API Base URL:</strong> {{ section.settings.api_base_url | escape }}</div>
        <div><strong>Script Status:</strong> <span id="pe-debug-script">Wachten...</span></div>
        <div><strong>Event Listeners:</strong> <span id="pe-debug-listeners">Wachten...</span></div>
        <div><strong>Last Action:</strong> <span id="pe-debug-action">Geen</span></div>
        <div><strong>Last Error:</strong> <span id="pe-debug-error" style="color: #dc2626;">Geen</span></div>
      </div>
    </div>
    
    <div class="pe-dashboard__grid">
      <section class="pe-card" id="pe-channable-card">
        <h2>Channable integratie</h2>
        <p>Configureer een feed-URL of API credentials om producten automatisch in te lezen.</p>
        <div id="pe-channable-status" class="pe-alert" hidden></div>
        <form id="pe-channable-form" novalidate>
          <div class="pe-field">
            <label for="pe-feed-url">Feed URL (XML/CSV)</label>
            <input type="url" id="pe-feed-url" name="feedUrl" placeholder="https://example.com/channable-feed.xml">
          </div>
          <div class="pe-field-group">
            <div class="pe-field">
              <label for="pe-company-id">Company ID</label>
              <input type="text" id="pe-company-id" name="companyId" placeholder="12345">
            </div>
            <div class="pe-field">
              <label for="pe-project-id">Project ID</label>
              <input type="text" id="pe-project-id" name="projectId" placeholder="67890">
            </div>
            <div class="pe-field">
              <label for="pe-api-token">API token</label>
              <input type="password" id="pe-api-token" name="apiToken" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
          </div>
          <div class="pe-field">
            <label for="pe-feed-format">Feed formaat</label>
            <select id="pe-feed-format" name="feedFormat">
              <option value="xml" selected>XML (Google Shopping)</option>
              <option value="csv">CSV</option>
            </select>
          </div>
          <div class="pe-card__footer">
            <button type="submit" class="pe-button pe-button--primary" id="pe-channable-save">Instellingen opslaan</button>
            <button type="button" class="pe-button pe-button--secondary" id="pe-channable-import">Nu importeren</button>
          </div>
        </form>
      </section>

      <section class="pe-card" id="pe-sitemap-card">
        <h2>Sitemap import</h2>
        <p>Importeer producten via jouw webshop sitemap.xml (geen Channable nodig).</p>
        <div id="pe-sitemap-status" class="pe-alert" hidden></div>
        <form id="pe-sitemap-form" novalidate>
          <div class="pe-field">
            <label for="pe-sitemap-url">Sitemap URL</label>
            <input type="url" id="pe-sitemap-url" name="sitemapUrl" placeholder="https://jouwwebshop.nl/sitemap.xml">
          </div>
          <div class="pe-field-group">
            <div class="pe-field">
              <label for="pe-max-products">Max producten</label>
              <input type="number" id="pe-max-products" name="maxProducts" min="1" max="500" value="50">
            </div>
            <div class="pe-field">
              <label for="pe-url-pattern">URL filter (optioneel)</label>
              <input type="text" id="pe-url-pattern" name="productUrlPattern" placeholder="/product/">
              <small class="pe-text-muted">Bijv. /product/ om alleen product paginas te importeren</small>
            </div>
          </div>
          <div class="pe-card__footer">
            <button type="submit" class="pe-button pe-button--primary" id="pe-sitemap-save">Instellingen opslaan</button>
            <button type="button" class="pe-button pe-button--secondary" id="pe-sitemap-import">Nu importeren</button>
          </div>
        </form>
      </section>

      <section class="pe-card" id="pe-shopify-card">
        <h2>Shopify catalogus sync</h2>
        <p>Push PriceElephant-producten naar de Shopify catalogus van deze klant.</p>
        <div id="pe-shopify-status" class="pe-alert" hidden></div>
        <div id="pe-shopify-stats" class="pe-card__content">
          <div class="pe-badges" id="pe-shopify-metrics"></div>
        </div>
        <div class="pe-card__footer">
          <div class="pe-field">
            <label for="pe-sync-limit">Aantal producten per batch</label>
            <input type="number" id="pe-sync-limit" name="syncLimit" min="1" max="200" value="10">
          </div>
          <div class="pe-field-group">
            <button type="button" class="pe-button pe-button--primary" id="pe-shopify-sync">Sync batch</button>
            <button type="button" class="pe-button pe-button--secondary" id="pe-shopify-sync-all">Sync alles</button>
          </div>
        </div>
      </section>
    </div>

    <section class="pe-card" id="pe-products-card">
      <h2>Producten</h2>
      <p>Overzicht van geÃ¯mporteerde producten inclusief concurrentinformatie.</p>
      <div class="pe-field" style="max-width: 320px;">
        <label for="pe-product-search">Zoek op naam, EAN of merk</label>
        <input type="search" id="pe-product-search" placeholder="Bijv. ThinkPad of 8719...">
      </div>
      <div class="pe-table-wrapper" aria-live="polite">
        <table class="pe-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>EAN</th>
              <th>Eigen prijs</th>
              <th>Varianten</th>
              <th>Concurrenten</th>
              <th>Sync status</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="pe-products-body"></tbody>
        </table>
      </div>
      <div id="pe-products-empty" class="pe-empty-state" hidden>
        Nog geen producten gevonden. Importeer via Channable en refresh.
      </div>
    </section>

    <section class="pe-card" id="pe-variants-card" hidden>
      <h2>Varianten voor <span id="pe-selected-variant-product-name"></span></h2>
      <div class="pe-badges" style="margin-bottom: 12px;">
        <span class="pe-badge" id="pe-selected-variant-product-sku"></span>
        <span class="pe-badge" id="pe-selected-variant-product-ean"></span>
      </div>
      <div id="pe-variants-status" class="pe-alert" hidden></div>
      <div id="pe-variants-empty" class="pe-empty-state" hidden>
        Geen varianten aangemaakt voor dit product.
      </div>
      <div class="pe-variants__list" id="pe-variants-list"></div>
      <form id="pe-variant-form" style="margin-top: 16px;" novalidate>
        <div class="pe-field-group">
          <div class="pe-field">
            <label for="pe-variant-title">Variant titel</label>
            <input type="text" id="pe-variant-title" name="variantTitle" placeholder="Rood / Large">
          </div>
        </div>
        <div class="pe-field-group">
          <div class="pe-field">
            <label for="pe-option1-name">Optie 1 naam</label>
            <input type="text" id="pe-option1-name" name="option1Name" placeholder="Kleur">
          </div>
          <div class="pe-field">
            <label for="pe-option1-value">Optie 1 waarde</label>
            <input type="text" id="pe-option1-value" name="option1Value" placeholder="Rood">
          </div>
        </div>
        <div class="pe-field-group">
          <div class="pe-field">
            <label for="pe-option2-name">Optie 2 naam (optioneel)</label>
            <input type="text" id="pe-option2-name" name="option2Name" placeholder="Maat">
          </div>
          <div class="pe-field">
            <label for="pe-option2-value">Optie 2 waarde (optioneel)</label>
            <input type="text" id="pe-option2-value" name="option2Value" placeholder="Large">
          </div>
        </div>
        <div class="pe-field-group">
          <div class="pe-field">
            <label for="pe-variant-sku">SKU (optioneel)</label>
            <input type="text" id="pe-variant-sku" name="sku" placeholder="PROD-RED-L">
          </div>
          <div class="pe-field">
            <label for="pe-variant-price">Prijs (optioneel)</label>
            <input type="number" id="pe-variant-price" name="price" step="0.01" placeholder="99.95">
          </div>
        </div>
        <button type="submit" class="pe-button pe-button--primary">Variant toevoegen</button>
      </form>
    </section>

    <section class="pe-card" id="pe-competitors-card" hidden>
      <h2>Concurrenten voor <span id="pe-selected-product-name"></span></h2>
      <div class="pe-badges" style="margin-bottom: 12px;">
        <span class="pe-badge" id="pe-selected-product-sku"></span>
        <span class="pe-badge" id="pe-selected-product-ean"></span>
        <span class="pe-badge" id="pe-selected-product-own-price"></span>
      </div>
      <div id="pe-competitors-status" class="pe-alert" hidden></div>
      <div id="pe-competitors-empty" class="pe-empty-state" hidden>
        Geen handmatige concurrenten toegevoegd voor dit product.
      </div>
      <div class="pe-competitors__list" id="pe-competitors-list"></div>
      <form id="pe-competitor-form" style="margin-top: 16px;" novalidate>
        <div class="pe-field-group">
          <div class="pe-field">
            <label for="pe-competitor-retailer">Retailer</label>
            <input type="text" id="pe-competitor-retailer" name="retailer" placeholder="coolblue">
          </div>
          <div class="pe-field" style="flex: 2 1 260px;">
            <label for="pe-competitor-url">Product URL</label>
            <input type="url" id="pe-competitor-url" name="competitorUrl" placeholder="https://www.coolblue.nl/product/...">
          </div>
        </div>
        <button type="submit" class="pe-button pe-button--primary">Concurrent toevoegen</button>
      </form>
    </section>
  </div>
{% else %}
  <div class="pe-card" style="max-width: 480px; margin: 48px auto; text-align: center;">
    <h2>Log eerst in</h2>
    <p>Deze dashboardpagina is alleen beschikbaar voor ingelogde PriceElephant-klanten.</p>
    <a href="/account" class="pe-button pe-button--primary" style="margin-top: 12px; display: inline-flex;">Naar login</a>
  </div>
{% endif %}

<script src="{{ 'priceelephant-dashboard.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "PriceElephant dashboard",
  "settings": [
    {
      "type": "text",
      "id": "api_base_url",
      "label": "API basis URL",
      "default": "https://web-production-2568.up.railway.app",
      "info": "Root URL van de PriceElephant backend (zonder trailing slash)."
    }
  ]
}
{% endschema %}
